<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Design Donor Card | Karnafuli Blood Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background: #f8fafc; }
        .design-card { cursor: pointer; border: 3px solid transparent; transition: 0.3s; }
        .design-card.active { border-color: #e11d48; transform: scale(1.05); }
    </style>
</head>
<body class="py-10 px-4">

<div class="max-w-6xl mx-auto">
    <div class="text-center mb-10">
        <h1 class="text-4xl font-black text-rose-600 mb-2">কর্ণফুলী ব্লাড হাব</h1>
        <p class="text-gray-600">আপনার পছন্দের ডিজাইনটি বেছে নিয়ে পোস্টার তৈরি করুন</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
        <div class="bg-white p-8 rounded-3xl shadow-xl border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <span class="bg-rose-600 w-2 h-6 rounded-full"></span> ১. তথ্য দিন ও ডিজাইন বাছুন
            </h2>
            
            <div class="space-y-4">
                <input type="text" id="nameInput" class="w-full border-2 border-gray-100 p-3 rounded-xl focus:border-rose-500 outline-none" placeholder="ডোনারের নাম">
                
                <div class="grid grid-cols-2 gap-4">
                    <select id="bgInput" class="border-2 border-gray-100 p-3 rounded-xl outline-none">
                        <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                        <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                    </select>
                    <input type="text" id="locationInput" class="border-2 border-gray-100 p-3 rounded-xl outline-none" placeholder="জেলা/উপজেলা">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="idInput" class="border-2 border-gray-100 p-3 rounded-xl outline-none" placeholder="ডোনার আইডি">
                    <input type="text" id="phoneInput" class="border-2 border-gray-100 p-3 rounded-xl outline-none" placeholder="হেল্পলাইন নম্বর">
                </div>

                <input type="file" id="imageInput" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-rose-50 file:text-rose-700">

                <div class="grid grid-cols-3 gap-3 pt-4">
                    <div onclick="selectDesign(1, this)" class="design-card active p-2 rounded-lg bg-rose-50 text-center text-xs font-bold">মডার্ন রেড</div>
                    <div onclick="selectDesign(2, this)" class="design-card p-2 rounded-lg bg-slate-800 text-white text-center text-xs font-bold">রয়্যাল ব্ল্যাক</div>
                    <div onclick="selectDesign(3, this)" class="design-card p-2 rounded-lg bg-green-50 text-center text-xs font-bold border-green-200">শান্তি (সবুজ)</div>
                </div>

                <button onclick="generatePoster()" class="w-full bg-rose-600 text-white py-4 rounded-2xl font-bold text-lg shadow-lg hover:bg-rose-700 transition-all mt-4">পোস্টার তৈরি করুন ✨</button>
            </div>
        </div>

        <div class="flex flex-col items-center">
            <canvas id="posterCanvas" width="800" height="1100" class="rounded-xl shadow-2xl w-full max-w-[450px] bg-white"></canvas>
            <div id="qrcode" class="hidden"></div>
            <button id="downloadBtn" style="display:none;" onclick="downloadPoster()" class="mt-6 bg-emerald-600 text-white px-10 py-3 rounded-full font-bold shadow-lg hover:bg-emerald-700 transition-all flex items-center gap-2">
                ডাউনলোড করুন (PNG)
            </button>
        </div>
    </div>
</div>

<script>
    let selectedDesign = 1;

    function selectDesign(id, el) {
        selectedDesign = id;
        document.querySelectorAll('.design-card').forEach(card => card.classList.remove('active'));
        el.classList.add('active');
        generatePoster(); // লাইভ প্রিভিউ চেঞ্জ করার জন্য
    }

    function generatePoster() {
        const canvas = document.getElementById('posterCanvas');
        const ctx = canvas.getContext('2d');
        const name = document.getElementById('nameInput').value || "রক্তদাতার নাম";
        const bloodGroup = document.getElementById('bgInput').value;
        const location = document.getElementById('locationInput').value || "ঠিকানা";
        const donorId = document.getElementById('idInput').value || "KBH-000";
        const phone = document.getElementById('phoneInput').value || "01XXX-XXXXXX";
        const imageInput = document.getElementById('imageInput');

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ডিজাইন থিম কনফিগ
        const themes = {
            1: { main: "#e11d48", sub: "#be123c", bg: "#ffffff", text: "#1f2937" }, // Modern Red
            2: { main: "#1e293b", sub: "#e11d48", bg: "#f1f5f9", text: "#1e293b" }, // Royal Black
            3: { main: "#059669", sub: "#047857", bg: "#ffffff", text: "#064e3b" }  // Peaceful Green
        };
        const theme = themes[selectedDesign];

        // ১. ব্যাকগ্রাউন্ড ড্রয়িং
        ctx.fillStyle = theme.bg;
        ctx.fillRect(0, 0, 800, 1100);

        // ২. ডিজাইন অনুযায়ী হেডার স্টাইল
        if (selectedDesign === 1) {
            ctx.fillStyle = theme.main;
            ctx.fillRect(0, 0, 800, 250);
        } else if (selectedDesign === 2) {
            ctx.fillStyle = theme.main;
            ctx.fillRect(0, 0, 800, 350);
        } else {
            ctx.strokeStyle = theme.main;
            ctx.lineWidth = 20;
            ctx.strokeRect(20, 20, 760, 1060);
        }

        const renderFinal = (userImg = null) => {
            // টাইটেল ও লোগো এরিয়া
            ctx.textAlign = "center";
            ctx.fillStyle = (selectedDesign === 3) ? theme.main : "white";
            ctx.font = "bold 55px 'Hind Siliguri'";
            ctx.fillText("কর্ণফুলী ব্লাড হাব", 400, 100);
            ctx.font = "22px 'Hind Siliguri'";
            ctx.fillText("১০০% স্বেচ্ছাসেবী সংগঠন | রক্ত দিন জীবন বাঁচান", 400, 145);

            // ছবির জন্য সার্কেল
            ctx.save();
            ctx.beginPath(); ctx.arc(400, 420, 160, 0, Math.PI * 2); ctx.clip();
            if (userImg) ctx.drawImage(userImg, 240, 260, 320, 320);
            else { ctx.fillStyle = "#e2e8f0"; ctx.fillRect(240, 260, 320, 320); }
            ctx.restore();
            ctx.strokeStyle = theme.sub; ctx.lineWidth = 8;
            ctx.beginPath(); ctx.arc(400, 420, 164, 0, Math.PI * 2); ctx.stroke();

            // কন্টেন্ট এরিয়া
            ctx.fillStyle = theme.text;
            ctx.font = "bold 40px 'Hind Siliguri'";
            ctx.fillText("আমি একজন গর্বিত রক্তদাতা!", 400, 640);

            ctx.fillStyle = theme.sub;
            ctx.font = "bold 55px 'Hind Siliguri'";
            ctx.fillText(name, 400, 720);

            // রক্তের গ্রুপ ব্যাজ
            ctx.fillStyle = theme.main;
            roundRect(ctx, 280, 750, 240, 60, 30); ctx.fill();
            ctx.fillStyle = "white";
            ctx.font = "bold 35px 'Hind Siliguri'";
            ctx.fillText(bloodGroup, 400, 792);

            // অন্যান্য তথ্য
            ctx.fillStyle = "#64748b";
            ctx.font = "26px 'Hind Siliguri'";
            ctx.fillText(`স্থান: ${location} | আইডি: ${donorId}`, 400, 850);

            // হেল্পলাইন ও বাণী
            ctx.fillStyle = theme.main;
            ctx.font = "bold 26px 'Hind Siliguri'";
            ctx.fillText("হেল্পলাইন: " + phone, 400, 900);

            ctx.fillStyle = "#94a3b8";
            ctx.font = "italic 20px 'Hind Siliguri'";
            ctx.fillText("“যে ব্যক্তি একজনের প্রাণ রক্ষা করল, সে যেন পুরো মানবজাতির প্রাণ রক্ষা করল।”", 400, 950);

            // কিউআর কোড ও CTA
            ctx.fillStyle = theme.text;
            ctx.font = "bold 18px sans-serif";
            ctx.fillText("Scan to Join: karnafuliblood.com", 400, 1080);
            
            const qrContainer = document.getElementById("qrcode");
            qrContainer.innerHTML = "";
            new QRCode(qrContainer, { text: "https://karnafuliblood.com/register", width: 80, height: 80 });

            setTimeout(() => {
                const qrImg = qrContainer.querySelector('img');
                if (qrImg) ctx.drawImage(qrImg, 360, 975, 80, 80);
                document.getElementById('downloadBtn').style.display = "flex";
            }, 300);
        };

        if (imageInput.files && imageInput.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                const img = new Image();
                img.onload = () => renderFinal(img);
                img.src = e.target.result;
            };
            reader.readAsDataURL(imageInput.files[0]);
        } else {
            renderFinal();
        }
    }

    function roundRect(ctx, x, y, w, h, r) {
        ctx.beginPath(); ctx.moveTo(x + r, y);
        ctx.arcTo(x + w, y, x + w, y + h, r);
        ctx.arcTo(x + w, y + h, x, y + h, r);
        ctx.arcTo(x, y + h, x, y, r);
        ctx.arcTo(x, y, x + w, y, r);
        ctx.closePath();
    }

    function downloadPoster() {
        const canvas = document.getElementById('posterCanvas');
        const link = document.createElement('a');
        link.download = `Karnafuli-Donor-Card-Design-${selectedDesign}.png`;
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
    }
</script>

</body>
</html>